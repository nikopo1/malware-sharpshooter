#!/bin/bash

#archive password
PASS=$1
#system calls xml file
SYSCALLS=$2
#zip archive containing the malware sample
ZIP=$3

TMPDIR=./tmp

# build files
make -C ./scid
make -C ./minimal

insmod scid/scid.ko

mkdir $TMPDIR

echo "Testing $ZIP for malspecs..."
unzip -P $PASS $ZIP -d $TMPDIR
for mal in $TMPDIR/*
do
	chmod +x $mal
	time ./minimal/main $SYSCALLS $mal minimal/benign_programs
done
rm -rf $TMPDIR/*

rm -rf $TMPDIR
