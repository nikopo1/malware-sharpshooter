#!/bin/bash

PASS=$1
SYSCALLS=$2
FILES=linuxmalware/*.zip
TMPDIR=./tmp

# build files
make -C ./scid
make -C ./minimal

insmod scid/scid.ko

mkdir $TMPDIR

for file in $FILES
do
	echo "Testing $file for malspecs..."
	unzip -P $PASS $file -d $TMPDIR
	for mal in $TMPDIR
	do
		./minimal/main $SYSCALLS $mal minimal/benign_programs
	done
	rm -rf $TMPDIR/*
done

rm -rf $TMPDIR
