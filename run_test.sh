#!/bin/bash

PASS=$1
FILES=linuxmalware/*.zip
TMPDIR=./tmp

# build files
make -C ./scid
make -C ./minimal

insmod scid/scid.ko

mkdir $TMPDIR

for file in $FILES
do
	echo "Testing $file for malspecs..."
	unzip -P $PASS $file -d $TMPDIR
	./minimal/main syscalls2.xml $TMPDIR/malware.exe minimal/benign_programs
	rm -rf $TMPDIR/*
done

rm -rf $TMPDIR
